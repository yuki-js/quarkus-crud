paths:
  /api/events/{eventId}/users/{userId}:
    get:
      tags:
        - Events
      summary: Get user data in event
      description: Retrieve the current user data for a specific user in an event. Requires authentication and the requester must be an attendee of the same event.
      operationId: getEventUserData
      parameters:
        - name: eventId
          in: path
          required: true
          description: Identifier of the event.
          schema:
            type: integer
            format: int64
        - name: userId
          in: path
          required: true
          description: Identifier of the user whose data is requested.
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User data found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/eventUserData.yaml#/EventUserData'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Access denied. Requester is not an attendee of the event.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Event, user, or user data not found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
    put:
      tags:
        - Events
      summary: Update user data in event
      description: Update the user's event-specific data. Creates a new revision. Requires authentication and the user can only update their own data.
      operationId: updateEventUserData
      parameters:
        - name: eventId
          in: path
          required: true
          description: Identifier of the event.
          schema:
            type: integer
            format: int64
        - name: userId
          in: path
          required: true
          description: Identifier of the user whose data is being updated.
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/eventUserData.yaml#/EventUserDataUpdateRequest'
      responses:
        '200':
          description: User data updated successfully.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/eventUserData.yaml#/EventUserData'
        '400':
          description: Invalid data supplied.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '403':
          description: Access denied. User can only update their own data.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Event or user not found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
  /api/events:
    post:
      tags:
        - Events
      summary: Create event
      description: Create a new event with the authenticated user as the initiator.
      operationId: createEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/event.yaml#/EventCreateRequest'
      responses:
        '201':
          description: Event created successfully.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/event.yaml#/Event'
        '400':
          description: Invalid event data supplied.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
  /api/events/{eventId}:
    get:
      tags:
        - Events
      summary: Get event by ID
      description: Fetch event details.
      operationId: getEventById
      parameters:
        - name: eventId
          in: path
          required: true
          description: Identifier of the event to fetch.
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Event found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/event.yaml#/Event'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Event not found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
  /api/users/{userId}/events:
    get:
      tags:
        - Events
      summary: List events initiated by a user
      description: Retrieve events created by the specified user.
      operationId: listEventsByUser
      parameters:
        - name: userId
          in: path
          required: true
          description: Identifier of the user.
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of events initiated by the user.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../components/schemas/event.yaml#/Event'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: User not found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
  /api/events/join-by-code:
    post:
      tags:
        - Events
      summary: Join event by invitation code
      description: Join an event by providing a valid invitation code.
      operationId: joinEventByCode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../components/schemas/event.yaml#/EventJoinByCodeRequest'
      responses:
        '201':
          description: Joined the event successfully.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/eventAttendee.yaml#/EventAttendee'
        '400':
          description: Invalid invitation code.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: No active event matches the invitation code.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '409':
          description: The user already joined the event.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
  /api/events/{eventId}/attendees:
    get:
      tags:
        - Events
      summary: List event attendees
      description: List attendees for the specified event.
      operationId: listEventAttendees
      parameters:
        - name: eventId
          in: path
          required: true
          description: Identifier of the event.
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: List of event attendees.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../components/schemas/eventAttendee.yaml#/EventAttendee'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Event not found.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
  /api/events/{eventId}/live:
    get:
      tags:
        - Events
      summary: Subscribe to event live updates
      description: Stream attendee updates for the specified event using Server-Sent Events.
      operationId: streamEventLive
      parameters:
        - name: eventId
          in: path
          required: true
          description: Identifier of the event.
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Stream of attendee updates.
          content:
            text/event-stream:
              schema:
                $ref: '../components/schemas/event.yaml#/EventLiveEvent'
              examples:
                attendeeJoined:
                  summary: Attendee joined event
                  value:
                    eventType: ATTENDEE_JOINED
                    eventId: 123
                    attendeeUserId: 456
                    timestamp: 2025-01-01T10:15:30Z
                    data:
                      attendeeProfile:
                        userId: 456
                        profileData:
                          nickname: quiz-fan
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '404':
          description: Event not found or access denied.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
        '500':
          description: Unexpected error.
          content:
            application/json:
              schema:
                $ref: '../components/schemas/common.yaml#/ErrorResponse'
