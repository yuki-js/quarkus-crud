# Production Configuration
# For development mode, see application-dev.properties which enables Dev Services
# and automatic PostgreSQL container management

# Please don't forget to modify manifests/application.properties as well, since this software is deployed on Kubernetes

# Database Configuration
quarkus.datasource.db-kind=postgresql
# Credentials/URL must be provided via environment variables (prod profile) or Dev Services.
%prod.quarkus.datasource.username=${QUARKUS_DATASOURCE_USERNAME:}
%prod.quarkus.datasource.password=${QUARKUS_DATASOURCE_PASSWORD:}
%prod.quarkus.datasource.jdbc.url=${QUARKUS_DATASOURCE_JDBC_URL:}

# Flyway Configuration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=classpath:db/migration

# MyBatis Configuration
mybatis.environment.id=quarkus

# OpenAPI Configuration
quarkus.smallrye-openapi.path=/openapi
# Use only YAML format for OpenAPI spec (no JSON generation)
quarkus.smallrye-openapi.info-title=Quarkus CRUD API
quarkus.smallrye-openapi.info-version=0.0.1

# Swagger UI Configuration
quarkus.swagger-ui.path=/swagger-ui
quarkus.swagger-ui.always-include=true

# SmallRye Health Configuration
# Health checks exposed at /healthz for external systems (Kubernetes, etc.)
quarkus.smallrye-health.root-path=/healthz

# JWT Configuration for Guest Authentication
# Production deployments must override these defaults via MP_JWT_VERIFY_PUBLICKEY_LOCATION /
# SMALLRYE_JWT_SIGN_KEY_LOCATION environment variables that point to Kubernetes Secrets.
mp.jwt.verify.publickey.location=${MP_JWT_VERIFY_PUBLICKEY_LOCATION:classpath:dev-keys/publicKey.pem}
mp.jwt.verify.issuer=https://quarkus-crud.ouchiserver.aokiapp.com
mp.jwt.verify.publickey.algorithm=ES256
smallrye.jwt.sign.key.location=${SMALLRYE_JWT_SIGN_KEY_LOCATION:classpath:dev-keys/privateKey.pem}
smallrye.jwt.new-token.issuer=https://quarkus-crud.ouchiserver.aokiapp.com
# Token lifespan configuration by authentication method
# Anonymous users: 365 days (31536000 seconds) - longer since they cannot re-authenticate
smallrye.jwt.new-token.lifespan.anonymous=31536000
# OIDC users: 1 hour (3600 seconds) - follows OAuth2 best practices for short-lived tokens
smallrye.jwt.new-token.lifespan.oidc=3600

# CORS Configuration
# Use regex pattern to allow all origins while respecting credentials
# Using /..*/ instead of wildcard * to allow Access-Control-Allow-Credentials
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=/.*/
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=authorization,content-type
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.access-control-allow-credentials=true
quarkus.http.cors.access-control-max-age=24H

# ================================
# Observability Configuration
# ================================

# Logging Configuration - JSON structured logging
# When JSON logging is enabled, the console format is ignored
quarkus.log.console.json=true
quarkus.log.console.json.pretty-print=false
# Include additional fields in logs
quarkus.log.console.json.additional-field."service.name".value=quarkus-crud
quarkus.log.console.json.additional-field."service.version".value=0.0.1
# Log level configuration
quarkus.log.level=INFO
quarkus.log.category."app.aoki.quarkuscrud".level=INFO

# Metrics Configuration - Micrometer + Prometheus
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics
# Binder configuration - enable various metrics collectors
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.http-client.enabled=true
quarkus.micrometer.binder.vertx.enabled=true

# ================================
# LLM Configuration (Azure OpenAI)
# ================================

# Azure OpenAI Service configuration via LangChain4j
# Production deployments must override these via environment variables
# For Azure OpenAI, use the standard OpenAI properties with Azure-specific configuration
quarkus.langchain4j.openai.api-key=${AZURE_OPENAI_API_KEY:dummy-key}
quarkus.langchain4j.openai.base-url=${AZURE_OPENAI_ENDPOINT:https://api.openai.com/v1}
quarkus.langchain4j.openai.timeout=60s
quarkus.langchain4j.openai.max-retries=3
quarkus.langchain4j.openai.log-requests=true
quarkus.langchain4j.openai.log-responses=true

# Azure-specific deployment name (model name)
%prod.quarkus.langchain4j.openai.chat-model.model-name=${AZURE_OPENAI_DEPLOYMENT_NAME:gpt-4}
%test.quarkus.langchain4j.openai.chat-model.model-name=gpt-3.5-turbo
%dev.quarkus.langchain4j.openai.chat-model.model-name=gpt-3.5-turbo
