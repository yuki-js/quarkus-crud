# Production Configuration
# For development mode, see application-dev.properties which enables Dev Services
# and automatic PostgreSQL container management

# Database Configuration
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=postgres
quarkus.datasource.password=postgres
# JDBC URL should be provided via environment variable in production/CI:
#   QUARKUS_DATASOURCE_JDBC_URL=jdbc:postgresql://localhost:5432/quarkus_crud
# For local development with Dev UI, use ./gradlew quarkusDev which uses application-dev.properties
# For tests, Dev Services will automatically provide the URL
# quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/quarkus_crud

# Flyway Configuration
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=classpath:db/migration

# MyBatis Configuration
mybatis.environment.id=quarkus

# OpenAPI Configuration
quarkus.smallrye-openapi.path=/openapi
# Use only YAML format for OpenAPI spec (no JSON generation)
quarkus.smallrye-openapi.info-title=Quarkus CRUD API
quarkus.smallrye-openapi.info-version=0.0.1

# Swagger UI Configuration
quarkus.swagger-ui.path=/swagger-ui
quarkus.swagger-ui.always-include=true

# SmallRye Health Configuration
# Detailed health checks available at /q/health (liveness, readiness, startup)
# Legacy /healthz endpoint preserved for backward compatibility
quarkus.smallrye-health.root-path=/q/health

# JWT Configuration for Guest Authentication
mp.jwt.verify.publickey.location=classpath:keys/publicKey.pem
mp.jwt.verify.issuer=https://quarkus-crud.ouchiserver.aokiapp.com
mp.jwt.verify.publickey.algorithm=ES256
smallrye.jwt.sign.key.location=classpath:keys/privateKey.pem
smallrye.jwt.new-token.issuer=https://quarkus-crud.ouchiserver.aokiapp.com
smallrye.jwt.new-token.lifespan=86400

# CORS Configuration
# Use regex pattern to allow all origins while respecting credentials
# Using /..*/ instead of wildcard * to allow Access-Control-Allow-Credentials
quarkus.http.cors.origins=/.*/
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.access-control-allow-credentials=true
quarkus.http.cors.access-control-max-age=24H

# ================================
# Observability Configuration
# ================================

# Logging Configuration - JSON structured logging
quarkus.log.console.format=%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n
quarkus.log.console.json=true
quarkus.log.console.json.pretty-print=false
# Include additional fields in logs
# Note: traceId and spanId are automatically included when using OpenTelemetry
quarkus.log.console.json.additional-field."service.name".value=quarkus-crud
quarkus.log.console.json.additional-field."service.version".value=0.0.1
# Log level configuration
quarkus.log.level=INFO
quarkus.log.category."app.aoki.quarkuscrud".level=INFO

# Metrics Configuration - Micrometer + Prometheus
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics
# Binder configuration - enable various metrics collectors
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.http-client.enabled=true
quarkus.micrometer.binder.vertx.enabled=true

# OpenTelemetry Configuration - Distributed Tracing
quarkus.otel.sdk.disabled=false
quarkus.otel.traces.enabled=true
# OTLP exporter configuration
# In production, set OTEL_EXPORTER_OTLP_ENDPOINT environment variable
# Example: http://otel-collector:4317
quarkus.otel.exporter.otlp.traces.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://localhost:4317}
quarkus.otel.exporter.otlp.traces.protocol=grpc
# Sampling configuration - use parent-based sampling with configurable rate
# For development: use high rate (0.5 or 1.0) for debugging
# For production: use low rate (0.1) to reduce overhead
quarkus.otel.traces.sampler=parentbased_traceidratio
quarkus.otel.traces.sampler.arg=${OTEL_TRACES_SAMPLER_ARG:0.5}
# Service name and resource attributes
quarkus.otel.resource.attributes=service.name=quarkus-crud,service.version=0.0.1,deployment.environment=${DEPLOYMENT_ENVIRONMENT:development}
# Propagation - use W3C Trace Context (standard)
quarkus.otel.propagators=tracecontext,baggage
